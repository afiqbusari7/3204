FROM ubuntu:22.04

#Update package list and install required packages
RUN apt-get update && \
    apt-get install -y \
    openssh-server \
    rsyslog \
    curl \
    libpcap0.8


#Packetbeat installation
RUN curl -L -O https://artifacts.elastic.co/downloads/beats/packetbeat/packetbeat-8.4.3-amd64.deb
RUN dpkg -i packetbeat-8.4.3-amd64.deb

#Filebeat installation
RUN curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.4.3-amd64.deb
RUN dpkg -i filebeat-8.4.3-amd64.deb

#Metricbeat installation
RUN curl -L -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-8.4.3-amd64.deb
RUN dpkg -i metricbeat-8.4.3-amd64.deb

#Start SSH service and expose port
RUN service ssh start
EXPOSE 22



ARG USER=bob
ARG UID=1000
ARG GID=1000

# default password for user
ARG PW=d0ck3r


# Using unencrypted password/ specifying password
RUN useradd -m ${USER} --uid=${UID}  --shell /bin/bash && echo "${USER}:${PW}" | \
     chpasswd

RUN mkdir /home/${USER}/.ssh
RUN mkdir ~/.ssh
RUN touch /home/${USER}/.ssh/authorized_keys

RUN chmod 700 home/${USER}/.ssh
RUN chmod 700 ~/.ssh
RUN chmod 640 /home/${USER}/.ssh/authorized_keys
RUN chown ${USER} /home/${USER}/.ssh
RUN chown ${USER} /home/${USER}/.ssh/authorized_keys

ADD /Company_Accounts.xlsx /home/${USER}

#change root password
RUN echo 'root:root' | chpasswd

ADD filebeat.yml /etc/filebeat/filebeat.yml
ADD packetbeat.yml /etc/packetbeat/packetbeat.yml
ADD metricbeat.yml /etc/metricbeat/metricbeat.yml

#Start rsyslog for logging and run SSH daemon
CMD ["/bin/sh","-c","rsyslogd; /usr/sbin/sshd -D"]
